version: '3'

tasks:
  lint:
    desc: "完 Run all linters (check only, no fixes)"
    cmds:
      - echo "完 Running linters (check mode)..."
      - task: check-ruff-format
      - task: check-ruff
      - task: mypy
    silent: true

  mypy:
    desc: "Run mypy checks."
    cmds:
      - echo "Running mypy checks..."
      - uv run mypy --check-untyped-defs --no-site-packages {{.PROJECT_SRC}}
    silent: true

  delint:
    desc: "完 Fix all linting issues automatically"
    cmds:
      - echo "完 Fixing linting issues..."
      - task: fix-ruff-format
      - task: fix-ruff
    silent: true

  check-ruff:
    desc: "Check ruff linter rules, but don't apply fixers. Used by CI."
    cmds:
      - uv run ruff check {{.PROJECT_SRC}} {{.TESTS_SRC}}
    silent: true

  check-ruff-format:
    desc: "Check formatting with ruff."
    cmds:
      - uv run ruff format --check {{.PROJECT_SRC}} {{.TESTS_SRC}}
    silent: true

  fix-ruff:
    desc: "Run ruff linter, applying fixers. Used by pre-commit."
    cmds:
      - uv run ruff check --fix {{.PROJECT_SRC}} {{.TESTS_SRC}}
    silent: true

  fix-ruff-format:
    desc: "Run ruff linter, applying formatting fixes."
    cmds:
      - uv run ruff format {{.PROJECT_SRC}} {{.TESTS_SRC}}
    silent: true
